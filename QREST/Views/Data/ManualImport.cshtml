@model QREST.Models.vmDataImport
@{
    ViewBag.Title = "Import Data";
    ViewBag.SubTitle = "Import hourly or n-minute raw data";
}

<div class="row">
    <div class="col-md-12">
        @using (Html.BeginForm("ManualImport", "Data", FormMethod.Post, new { @class = "", enctype = "multipart/form-data", @id = "norepostform" }))
        {
            @Html.AntiForgeryToken()

            <section class="panel panel-qrest">
                <div class="panel-heading font-bold">
                    Paste Data Below to Import
                </div>
                <div class="panel-body">
                    <div class="form-inline m-b-sm" onsubmit="return false">
                        @Html.DropDownListFor(model => model.selOrgID, Model.ddl_Organization, "--Organization--", new { @class = "form-control" })
                        @Html.DropDownListFor(model => model.selSite, Model.ddl_Sites, "--Site--", new { @class = "form-control" })
                        <select id="selType" class="form-control">
                            <option value="">Please Select</option>
                            <option value="H">Hourly</option>
                            <option value="F">5-Minute</option>
                        </select>
                        <a id="tempUrl" class="btn btn-warning pull-right" data-root="@Url.Action("DownloadTemplateBySite","Site")" href="@Url.Action("DownloadTemplateBySite","Site", new { id = "1" })">Download import template</a>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                @Html.TextAreaFor(model => model.IMPORT_BLOCK, new { @class = "form-control", @placeholder = "(Paste data here)", @rows = "10" })
                                @Html.ValidationMessageFor(model => model.IMPORT_BLOCK)
                            </div>
                        </div>
                        <div class="col-md-12">
                            <button type="submit" class="btn btn-primary">Import Data</button>
                        </div>
                    </div>
                    <div class="row">
                    </div>
                </div>
            </section>
        }
    </div>
</div>

@*@if (Model.raw_data != null)
    {
        <h3>Validation Summary</h3>
        <span class="">Some records have import validation errors. Please fix and reimport the entire data set.</span>
        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered" data-ride="datatables">
                        <tr>
                            <th>Validation Message</th>
                            <th>Organization</th>
                            <th>Record Source</th>
                            <th>Project Name</th>
                            <th>Project Description</th>
                            <th>Media</th>
                            <th>Start Year</th>
                            <th>Project Status</th>
                            <th>Last Update</th>
                            <th>URL</th>
                            <th>Mobile</th>
                            <th>Adv Mon</th>
                            <th>BP Improve</th>
                        </tr>

                        @foreach (var item in Model.raw_data)
                        {
                            <tr class="@(item.VALIDATE_CD ? "success":"danger")">
                                <td>
                                    @Html.DisplayFor(modelItem => item.VALIDATE_MSG)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.ORG_NAME)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.T_OE_PROJECT.RECORD_SOURCE)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.T_OE_PROJECT.PROJ_NAME)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.T_OE_PROJECT.PROJ_DESC)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.MEDIA_NAME)
                                </td>

                            </tr>
                        }
                    </table>
                </div>
            </div>
        </div>
    }*@

@section Scripts{
    <script>
        $(document).ready(function () {

            //update monitor dropdown
            $('#selOrgID').change(function () {
                var url = '@Url.Action("FetchSites")';
                var mons = $('#selSite');
                mons.empty();
                $.getJSON(url, { ID: $(this).val() }, function (data) {
                    if (!data) {
                        return;
                    }
                    mons.append($('<option></option>').val('').text('Please select'));
                    $.each(data, function (index, item) {
                        mons.append($('<option></option>').val(item.Value).text(item.Text));
                    });
                });

            });

            $('#selSite').change(function () {
                var xxx = $("#tempUrl").data('root');
                $("#tempUrl").attr('href', xxx + '/' + $(this).val());
            });

        });

    </script>
}